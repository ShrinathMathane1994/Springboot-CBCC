CREATE TABLE test_cases (
    idtc SERIAL PRIMARY KEY,
    tc_name VARCHAR(255),
    description TEXT,
    feature_scenario_json TEXT,
    input_file VARCHAR(500),
    output_file VARCHAR(500),
    created_on TIMESTAMP,
    modified_on TIMESTAMP,
    last_run_on TIMESTAMP,
    last_run_status VARCHAR(100),
    is_active BOOLEAN DEFAULT TRUE,
    country VARCHAR(100),
    region VARCHAR(100),
    pod VARCHAR(100)
);
----------------------


CREATE TABLE test_case_history (
    id SERIAL PRIMARY KEY,
    test_case_id INT NOT NULL,
    tc_name VARCHAR(255),
    description TEXT,
    feature_scenario_json TEXT,
    input_file VARCHAR(500),
    output_file VARCHAR(500),
    modified_on TIMESTAMP,
    change_type VARCHAR(50),
    country VARCHAR(100),
    region VARCHAR(100),
    pod VARCHAR(100),
    CONSTRAINT fk_history_test_case
        FOREIGN KEY (test_case_id)
        REFERENCES test_cases(idtc)
        ON DELETE CASCADE
);


------------------------

CREATE TABLE test_case_run_history (
    id SERIAL PRIMARY KEY,
    test_case_id INT NOT NULL,
    run_on TIMESTAMP,
    run_status VARCHAR(100),
    output_log TEXT,
    executed_scenarios TEXT,
    unexecuted_scenarios TEXT,
    raw_log TEXT,
    xmlparsed_differences_json TEXT,
    xml_diff_status VARCHAR(50),
    CONSTRAINT fk_run_test_case
        FOREIGN KEY (test_case_id)
        REFERENCES test_cases(idtc)
        ON DELETE CASCADE
);

-------------------------
CREATE TABLE country (
    id_country BIGSERIAL PRIMARY KEY,
    country_name VARCHAR(255) NOT NULL,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_on TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
-------------------------
CREATE TABLE region (
    id_region BIGSERIAL PRIMARY KEY,
    region_name VARCHAR(255) NOT NULL,
    id_country BIGINT NOT NULL,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_on TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    CONSTRAINT fk_country FOREIGN KEY (id_country) REFERENCES country (id_country)
);
------------------------
CREATE TABLE pod (
    id_pod BIGSERIAL PRIMARY KEY,
    pod_name VARCHAR(255) NOT NULL,
    id_region BIGINT NOT NULL,
    created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_on TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE,
    CONSTRAINT fk_region FOREIGN KEY (id_region) REFERENCES region (id_region)
);
-----------------------
INSERT INTO country (country_name, created_on, is_active)
VALUES 
('UK', CURRENT_TIMESTAMP, TRUE),
('US', CURRENT_TIMESTAMP, TRUE);
-------------------------------
-- Regions under UK
INSERT INTO region (region_name, id_country, created_on, is_active)
VALUES
('EMEA', 1, CURRENT_TIMESTAMP, TRUE);

-- Regions under US
INSERT INTO region (region_name, id_country, created_on, is_active)
VALUES
('APAC', 2, CURRENT_TIMESTAMP, TRUE);
-----------------------
INSERT INTO pod (pod_name, id_region, created_on, is_active)
VALUES
('E1-POD', 1, CURRENT_TIMESTAMP, TRUE),
('E2-POD', 1, CURRENT_TIMESTAMP, TRUE),
('S1-POD', 1, CURRENT_TIMESTAMP, TRUE),
('U1-POD', 1, CURRENT_TIMESTAMP, TRUE),
('Q1-POD', 1, CURRENT_TIMESTAMP, TRUE),
('C1-POD', 1, CURRENT_TIMESTAMP, TRUE),
('C2-POD', 1, CURRENT_TIMESTAMP, TRUE),
('N1-POD', 1, CURRENT_TIMESTAMP, TRUE);
---------------------------
INSERT INTO pod (pod_name, id_region, created_on, is_active)
VALUES
('A2-POD', 2, CURRENT_TIMESTAMP, TRUE),
('A3-POD', 2, CURRENT_TIMESTAMP, TRUE),
('E1-POD', 2, CURRENT_TIMESTAMP, TRUE),
('Q1-POD', 2, CURRENT_TIMESTAMP, TRUE),
('E2-POD', 2, CURRENT_TIMESTAMP, TRUE),
('C2-POD', 2, CURRENT_TIMESTAMP, TRUE);
---------------------------
SELECT 
    c.id_country,
    c.country_name,
    r.id_region,
    r.region_name,
    p.id_pod,
    p.pod_name,
    c.created_on AS country_created,
    r.created_on AS region_created,
    p.created_on AS pod_created
FROM country c
JOIN region r ON r.id_country = c.id_country
JOIN pod p ON p.id_region = r.id_region
WHERE c.is_active = TRUE
  AND r.is_active = TRUE
  AND p.is_active = TRUE
ORDER BY c.country_name, r.region_name, p.pod_name;

--------------------------

CREATE TABLE scenario_example_run (
    id BIGSERIAL PRIMARY KEY,
    test_execution_id BIGINT NOT NULL,
    test_case_id BIGINT NOT NULL,
    feature_file_name VARCHAR(512),
    feature_file_path TEXT,
    scenario_name VARCHAR(2000),
    scenario_type VARCHAR(64),
    example_header_json TEXT,
    example_values_json TEXT,
    status VARCHAR(64),
    duration_ms BIGINT,
    input_xml TEXT,
    output_xml TEXT,
    differences_json TEXT,
    errors_json TEXT,
    xml_diff_status VARCHAR(64),
    created_at TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT now()
);

-- foreign keys (adjust referenced table/column names if needed)
ALTER TABLE scenario_example_run
    ADD CONSTRAINT fk_scenario_example_run_execution
    FOREIGN KEY (test_execution_id) REFERENCES test_case_run_history(id);

ALTER TABLE scenario_example_run
    ADD CONSTRAINT fk_scenario_example_run_test_case
    FOREIGN KEY (test_case_id) REFERENCES test_cases(idTC);

-- helpful indexes for queries
CREATE INDEX idx_scenario_example_run_execution ON scenario_example_run(test_execution_id);
CREATE INDEX idx_scenario_example_run_test_case ON scenario_example_run(test_case_id);
CREATE INDEX idx_scenario_example_run_created_at ON scenario_example_run(created_at);
CREATE INDEX idx_scenario_example_run_xml_diff_status ON scenario_example_run(xml_diff_status);

